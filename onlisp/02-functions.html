<!DOCTYPE HTML>
<html lang="kr" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>02. 함수 - catchup-onlisp</title>


        <!-- Custom HTML head -->

        <meta name="description" content="catchup-onlisp">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">catchup-onlisp</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/lispkorea/catchup-onlisp" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/lispkorea/catchup-onlisp/edit/main/src/onlisp/02-functions.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="02-함수"><a class="header" href="#02-함수">02 함수</a></h1>
<h2 id="21-데이터로서-함수"><a class="header" href="#21-데이터로서-함수">2.1 데이터로서 함수</a></h2>
<ul>
<li>
<p>리스프 자체가 함수 집합</p>
<ul>
<li>새로운 오퍼레이터를 추가할 수 있음.</li>
</ul>
</li>
<li>
<p>리스프 함수는</p>
<ul>
<li>런타임에 생성하고 반환 가능</li>
<li>인수로 전달가능</li>
<li>변수가 값으로 함수를 가질 수 있다.</li>
<li>함수단위나 파일 단위로 컴파일할 수 있다.</li>
</ul>
</li>
</ul>
<h2 id="22-함수-정의"><a class="header" href="#22-함수-정의">2.2 함수 정의</a></h2>
<ul>
<li>함수 정의 방법
<ul>
<li>defun</li>
<li>lambda</li>
</ul>
</li>
</ul>
<p><code>defun</code>으로 함수 정의하기</p>
<pre><code class="language-lisp">(defun my-double (x)
  (* x 2))

#'my-double
;;=&gt; #&lt;Interpreted-Function C66ACE&gt;

(my-double 3)
;;=&gt; 6
</code></pre>
<p><code>lambda</code>로 함수 정의하기</p>
<pre><code class="language-lisp">#'(lambda (x) (* x 2))
;;=&gt; #&lt;Interpreted-Function C674CE&gt;

((lambda (x) (* x 2)) 3)
;;=&gt; 6
</code></pre>
<p>함수/변수는 다른 이름공간을 가지고 있다.</p>
<div class="table-wrapper"><table><thead><tr><th></th><th>이름 공간 분리</th><th>ex</th></tr></thead><tbody>
<tr><td>Lisp-1</td><td>분리를 안함.</td><td>Clojure</td></tr>
<tr><td>Lisp-2</td><td>분리를 함.</td><td>Common Lisp</td></tr>
</tbody></table>
</div>
<pre><code class="language-lisp">(setq my-double 2)
;;=&gt; 2

(my-double my-double)
;;=&gt; 4

(symbol-value 'my-double)
;;=&gt; 2

(symbol-function 'my-double)
;;=&gt; #&lt;Interpreted-Function C66ACE&gt;
</code></pre>
<pre><code class="language-lisp">(setq x #'append)
;;=&gt; #&lt;Compiled-Function 46B4BE&gt;

(eq (symbol-value 'x)
    (symbol-function 'append))
;;=&gt; T

(eq #'my-double (car (list #'my-double)))
;;=&gt; T
</code></pre>
<p><code>defun</code>은 심볼을 함수 이름 공간에 추가한다.</p>
<pre><code class="language-lisp">(defun my-double (x)
  (* x 2))

(setf (symbol-function 'my-double)
      #'(lambda (x) (* x 2)))
</code></pre>
<h2 id="23-인자로서의-함수"><a class="header" href="#23-인자로서의-함수">2.3 인자로서의 함수</a></h2>
<p><code>apply</code> 사용법</p>
<pre><code class="language-lisp">(+ 1 2)
;;=&gt; 3

(apply #'+ '(1 2))
;;=&gt; 3

(apply (symbol-function '+) '(1 2))
;;=&gt; 3

(apply #'(lambda (x y) (+ x y)) '(1 2))
;;=&gt; 3
</code></pre>
<p><code>funcall</code> 사용법</p>
<pre><code class="language-lisp">(apply #'+ 1 '(2))
;;=&gt; 3

(funcall #'+ 1 2)
;;=&gt; 3
</code></pre>
<p><code>mapcar</code> 사용법</p>
<pre><code class="language-lisp">(mapcar #'(lambda (x) (+ x 10))
          '(1 2 3))
;;=&gt; (11 12 13)

(mapcar #'+
        '(1 2 3)
        '(10 100 1000))
;;=&gt; (11 102 1003)
</code></pre>
<p><code>sort</code> 사용법</p>
<pre><code class="language-lisp">(sort '(1 4 2 5 6 7 3) #'&lt;)
;;=&gt; (1 2 3 4 5 6 7)
</code></pre>
<p><code>remove-if</code> 사용법</p>
<pre><code class="language-lisp">(remove-if #'evenp '(1 2 3 4 5 6 7))
;;=&gt; (1 3 5 7)

(defun our-remove-if (fn lst)
  (if (null lst)
      nil
      (if (funcall fn (car lst))
          (our-remove-if fn (cdr lst))
          (cons (car lst) (our-remove-if fn (cdr lst))))))
</code></pre>
<h2 id="24-속성으로서의-함수"><a class="header" href="#24-속성으로서의-함수">2.4 속성으로서의 함수</a></h2>
<pre><code class="language-lisp">(defun behave (animal)
  (case animal
    (dog
     (wag-tail)
     (bark))
    (rat
     (scurry)
     (squeak))
    (cat
     (rub-legs)
     (scratch-carpet))
    (human
     (speak))))

(defun wag-tail () (print "wag-tail"))
(defun bark () (print "bark"))
(defun scurry () (print "scurry"))
(defun squeak () (print "squeak"))
(defun rub-legs () (print "rub-legs"))
(defun scratch-carpet () (print "scratch-carpet"))
(defun speak () (print "speak"))

(behave 'dog)
;;&gt;&gt; "wag-tail"
;;&gt;&gt; "bark"

(behave 'rat)
;;&gt;&gt; "scurry"
;;&gt;&gt; "squeak"

(behave 'cat)
;;&gt;&gt; "rub-legs"
;;&gt;&gt; "scratch-carpet"

(behave 'human)
;;&gt;&gt; speak
</code></pre>
<pre><code class="language-lisp">(defun behave2 (animal)
  (funcall (get animal 'behavior)))

(setf (get 'dog 'behavior)
      #'(lambda ()
          (wag-tail)
          (bark)))

(behave2 'dog)
;;&gt;&gt; "wag-tail"
;;&gt;&gt; "bark"

(setf (get 'all 'behavior)
      #'(lambda ()
          (bark)
          (scurry)
          (scratch-carpet)))

(behave2 'all)
;;&gt;&gt; "bark"
;;&gt;&gt; "scurry"
;;&gt;&gt; "scratch-carpet"

</code></pre>
<h2 id="25-범위scope"><a class="header" href="#25-범위scope">2.5 범위(Scope)</a></h2>
<div class="table-wrapper"><table><thead><tr><th>scope-test함수에서</th><th></th><th></th></tr></thead><tbody>
<tr><td>binding</td><td>x</td><td>매개변수 x와 바인딩되어있다.</td></tr>
<tr><td>free variable</td><td>y</td><td>스코프 환경에 따라 다르게됨</td></tr>
</tbody></table>
</div><div class="table-wrapper"><table><thead><tr><th>스코프</th><th></th><th>y 의 값</th></tr></thead><tbody>
<tr><td>다이나믹(dynamic)</td><td>함수의 호출 체인을 거슬러 올라감</td><td>5</td></tr>
<tr><td>렉시컬(lexical)</td><td>함수가 정의 된 시점의 환경을 거슬러 올라감</td><td>7</td></tr>
</tbody></table>
</div>
<pre><code class="language-lisp">(let ((y 7))
  (defun scope-test (x)
    (list x y)))

;; 다이나믹 스코프
;; - y의 값: 함수 호출을 감싼 let으로 정의한 5.
(let ((y 5))
  (scope-test 3))
;;=&gt; (3 5)

;; 렉시컬 스코프 - Common Lisp 기본 설정
;; - y의 값: 앞서 defun시 감싼 let으로 정의한 7.
(let ((y 5))
  (scope-test 3))
;;=&gt; (3 7)
</code></pre>
<h2 id="26-클로져closures"><a class="header" href="#26-클로져closures">2.6 클로져(Closures)</a></h2>
<p>함수에서 binding되지 않는 변수, 즉 free 변수가 있을 때, 그 변수를 포함하는 함수를 클로져라고 한다.</p>
<pre><code class="language-lisp">(defun list+ (lst n)
  (mapcar #’(lambda (x) (+ x n))
          lst))

(list+ ’(1 2 3) 10)
;;=&gt; (11 12 13)
</code></pre>
<pre><code class="language-lisp">(let ((counter 0))
  (defun new-id ()
    (incf counter))
  (defun reset-id ()
    (setq counter 0)))

(defun make-adder (n)
  #’(lambda (x) (+ x n)))

(setq add2 (make-adder 2)
      add10 (make-adder 10))

(funcall add2 5)
;;=&gt; 7
(funcall add10 3)
;;=&gt; 13
</code></pre>
<pre><code class="language-lisp">(defun make-adderb (n)
  #’(lambda (x &amp;optional change)
       (if change
           (setq n x)
           (+ x n))))

(setq addx (make-adderb 1))

(funcall addx 3)
;;=&gt; 4

(funcall addx 100 t)
;;=&gt; 100

(funcall addx 3)
;;=&gt; 103
</code></pre>
<pre><code class="language-lisp">(defun make-dbms (db)
  (list
    #’(lambda (key)
        (cdr (assoc key db)))
    #’(lambda (key val)
        (push (cons key val) db)
        key)
    #’(lambda (key)
        (setf db (delete key db :key #’car))
        key)))

(setq cities (make-dbms ’((boston . us) (paris . france))))

(funcall (car cities) ’boston)
;;=&gt; US

(funcall (second cities) ’london ’england)
;;=&gt; LONDON

(funcall (car cities) ’london)
;;=&gt; ENGLAND

(defun lookup (key db)
  (funcall (car db) key))
</code></pre>
<h2 id="27-지역-함수"><a class="header" href="#27-지역-함수">2.7 지역 함수</a></h2>
<p><code>labels</code> 사용법</p>
<pre><code class="language-lisp">(labels ((inc (x) (1+ x)))
  (inc 3))
;;=&gt; 4
</code></pre>
<h2 id="28-꼬리-재귀tail-recursion"><a class="header" href="#28-꼬리-재귀tail-recursion">2.8 꼬리 재귀(Tail-Recursion)</a></h2>
<p><code>our-length</code>함수의 끝이 <code>our-length</code>으로 끝나는게 아니라 <code>1+</code>가 감싸는 형태로 되어있다. 이와 같은 형태는 꼬리 재귀 형태가 될 수 없다.</p>
<pre><code class="language-lisp">(defun our-length (lst)
  (if (null lst)
      0
      (1+ (our-length (cdr lst)))))
</code></pre>
<p><code>our-find-if</code>는 <code>our-find-if</code>로 끝나는 꼬리 재귀 형태이다.</p>
<pre><code class="language-lisp">(defun our-find-if (fn lst)
  (if (funcall fn (car lst))
      (car lst)
      (our-find-if fn (cdr lst))))
</code></pre>
<p><code>our-length</code>는 <code>labels</code>를 이용하여 내부에 꼬리 재귀 형태의 <code>rec</code> 함수를 정의하였다.</p>
<pre><code class="language-lisp">(defun our-length (lst)
  (labels ((rec (lst acc)
             (if (null lst)
                 acc
                 (rec (cdr lst) (1+ acc)))))
    (rec lst 0)))
</code></pre>
<pre><code class="language-lisp">;; Common Lisp에서 꼬리 재귀 최적화를 디폴트가 아닌 경우, 다음과 같이 추가 선언이 필요하다.
(proclaim '(optimize speed))
</code></pre>
<pre><code class="language-lisp">;; 속도 향상을 위한 꼬리 재귀 + 타입 선언 예제.
;; 1 ~ n 까지의 합을 구하는 함수.

(defun triangle (n)
  (labels ((tri (c n)
             (declare (type fixnum n c))
             (if (zerop n)
                 c
                 (tri (the fixnum (+ n c))
                      (the fixnum (- n 1))))))
    (tri 0 n)))
</code></pre>
<h2 id="29-컴파일"><a class="header" href="#29-컴파일">2.9 컴파일</a></h2>
<ul>
<li><code>compile</code>함수 사용하여, 함수를 컴파일</li>
<li><code>compile-file</code>함수 사용하여, 파일을 컴파일</li>
</ul>
<pre><code class="language-lisp">(defun foo (x)
  (1+ x))
;;=&gt; FOO


;; 컴파일 됐는지 여부 확인
(compiled-function-p #’foo)
;;=&gt; NIL

(compile ’foo)
;;=&gt; FOO

(compiled-function-p #’foo)
;;=&gt; T

;; 익명함수 컴파일
(compile nil '(lambda (x) (+ x 2)))
;;=&gt; #&lt;Compiled-Function BF55BE&gt;

;; 익명함수에 이름을 붙여 컴파일
(progn
  (compile 'bar '(lambda (x) (* x 3)))
  (compiled-function-p #’bar))
;;=&gt; T


;; 렉시컬 환경에서는 컴파일이 안된다.
(let ((y 2))
  (defun foo (x)
    (+ x y)))

;; 함수를 리턴하는 함수를 컴파일하면, 리턴되는 함수도 컴파일이 되는걸 확인 할 수 있다.
(compile 'make-adder)
;;=&gt; MAKE-ADDER
(compiled-function-p (make-adder 2))
;;=&gt; T

;; 인라인 함수의 예제
(proclaim '(inline 50th))
(defun 50th (lst)
  (nth 49 lst))

(defun foo (lst)
  (+ (50th lst) 1) ;; =&gt; (+ (nth 49 lst) 1)
  )
</code></pre>
<h2 id="210-functions-from-lists"><a class="header" href="#210-functions-from-lists">2.10 Functions from Lists</a></h2>
<p>패스</p>
<h2 id="짚고-넘어가기"><a class="header" href="#짚고-넘어가기">짚고 넘어가기</a></h2>
<ul>
<li>defun</li>
<li>eq</li>
<li>lambda</li>
<li>symbol-value</li>
<li>symbol-function</li>
<li>lisp1 / lisp2</li>
<li><a href="https://www.lispworks.com/documentation/lw50/CLHS/Body/s_setq.htm">setq</a></li>
<li>mapcar</li>
<li>funcall</li>
<li>labels</li>
<li>let</li>
<li>case</li>
<li>declare
<ul>
<li>type</li>
</ul>
</li>
<li>proclaim
<ul>
<li>inline</li>
</ul>
</li>
<li>optimize</li>
<li>compiled-function-p</li>
<li>compile</li>
<li>copmile-file</li>
<li>progn</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../onlisp/01-extensible-language.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../onlisp/03-functional-programming.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../onlisp/01-extensible-language.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../onlisp/03-functional-programming.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
